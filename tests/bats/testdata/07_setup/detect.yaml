
# TODO: windows, use_time_machine, event support (see https://hub.crowdsec.net/author/crowdsecurity/collections/iis)
#

---
version: 1.0

services:

  #
  # crowdsecurity-apache2
  #

  apache2:
    when:
      - ProcessRunning("apache2")
    collection: crowdsecurity/apache2
    acquis:
      labels:
        type: apache2
      log_files:
        - /var/log/apache2/*.log
        - /var/log/*http*/*.log
        - /var/log/httpd/*.log

  apache2-systemd:
    when:
      - UnitFound("apache2.service")
      - OS.ID != "centos"
    collection: crowdsecurity/apache2
    acquis:
      journalctl_filter:
        - "_SYSTEMD_UNIT=mock-apache2.service"
      labels:
        type: apache2

      # XXX how

  apache2-systemd-centos:
    when:
      - UnitFound("httpd.service")
      - OS.ID == "centos"
    collection: crowdsecurity/apache2
    acquis:
      journalctl_filter:
        - "_SYSTEMD_UNIT=httpd.service"


  # XXX /var/log/auth.log ?
  ssh-systemd:
    when:
      - UnitFound("ssh.service") or UnitFound("ssh.socket")
    collection: crowdsecurity/apache2
    acquis:
      journalctl_filter:
        - "_SYSTEMD_UNIT=ssh.service"
      labels:
        type: syslog


  linux:
    when:
      - OS.Family == "linux"
    collection: crowdsecurity/linux
    acquis:
      labels:
        type: syslog
      log_files:
      - /var/log/syslog
      - /var/log/kern.log
      - /var/log/messages

  freebsd:
    when:
      - OS.Family == "freebsd"
    collection: crowdsecurity/freebsd

  windows:
    when:
      - OS.Family == "windows"
    collection: crowdsecurity/windows
